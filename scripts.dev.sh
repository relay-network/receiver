#!/bin/bash -e

# #############################################################################
#
# nuke previous artifacts
#
# #############################################################################

if [ -z "${1}" ] || [ "${1}" = "nuke" ]; then
  rm -rf node_modules
  rm -rf dist
fi

# #############################################################################
#
# install dependencies
#
# #############################################################################

if [ -z "${1}" ] || [ "${1}" = "deps" ]; then
  npm install
fi

# #############################################################################
#
# check for linter errors
#
# #############################################################################

if [ -z "${1}" ] || [ "${1}" = "lint" ]; then
  npx eslint --max-warnings=0 .
fi

# #############################################################################
#
# check formatting
#
# #############################################################################

if [ -z "${1}" ] || [ "${1}" = "format" ]; then
  npx prettier --check .
fi

# #############################################################################
#
# build the app (and typecheck)
#
# #############################################################################

if [ -z "${1}" ] || [ "${1}" = "build" ]; then
  npx vite build
fi

# #############################################################################
#
# run the dev server
#
# #############################################################################

if [ -z "${1}" ] || [ "${1}" = "dev" ]; then
  npm link ../xmtp-js
  npx vite
fi

# #############################################################################
#
# run e2e tests
#
# #############################################################################

if [ "${1}" = "test" ]; then
  echo "no tests to run"
fi